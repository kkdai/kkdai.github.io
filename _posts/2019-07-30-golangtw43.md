---
layout: post
title: "[ç ”è¨æœƒå¿ƒå¾—] 20190730 GolangTW @M Space - Introducing the go channel and pipeline buffered/unbuffered channel"
description: ""
category: 
- ç ”è¨æœƒå¿ƒå¾—
- golang
tags: ["ç ”è¨æœƒå¿ƒå¾—", "DevRel", "LINE_DM", "LINE", "Go"]
---

![](../images/2019/0730.jpg)




# å‰è¨€

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ LINE Taiwan çš„ Technical Evangelist - Evan Linã€‚é€™æ¬¡å¾ˆé–‹å¿ƒå›åˆ° Golang ç¤¾ç¾¤åƒåŠ äº† "[GolangTaipeiGathering#423](https://www.meetup.com/golang-taipei-meetup/events/262192288/)" çš„èšæœƒæ´»å‹•ã€‚

- ç¤¾ç¾¤ GolangTW Meetupï¼š https://www.meetup.com/golang-taipei-meetup/

- æœ¬æ¬¡æ´»å‹•ç¶²é :  [æ´»å‹•ç¶²å€](https://www.meetup.com/golang-taipei-meetup/events/262192288/)

é€™æ¬¡åƒèˆ‡ç¤¾ç¾¤çš„èšæœƒä¸»è¦æ˜¯å¸Œæœ›é€éåˆ†äº«ä¸€å€‹è³‡æ–™è™•ç†ä¸Šå®¹æ˜“æ‰€é¢è‡¨çš„å•é¡Œï¼Œä¾†è§£é‡‹ Go(lang) è£¡é¢ä¸€å€‹ç¶“å¸¸è®“äººå›°æ“¾çš„å•é¡Œï¼Œä¹Ÿå°±æ˜¯ Buffered/UnBuffered Channel çš„å·®ç•°ï¼Œå¦‚ä½•æ‡‰ç”¨èˆ‡å¦‚ä½•é€é Channel ä¾†å®Œæˆ Data Pipeline ã€‚



##  Introducing the go channel and pipeline buffered/unbuffered channel / è³‡æ·±é–‹ç™¼æŠ€è¡“æ¨å»£å·¥ç¨‹å¸« Evan Lin

#### [æŠ•å½±ç‰‡](https://go-talks.appspot.com/github.com/kkdai/GolangTalks/introduction-channel-2019/gochannel.slide)

ä»¥å‰åœ¨åš Machine Learning Platform çš„æ™‚å€™ï¼Œæœ‰æ©Ÿæœƒå¯ä»¥é–‹ç™¼è³‡æ–™è™•ç†çš„ pipeline ã€‚é–‹ç™¼èƒ½è™•ç†è³‡æ–™è™•ç†çš„ç›¸é—œåŠŸèƒ½çš„æ™‚å€™ï¼Œæœ€é‡è¦çš„å°±æ˜¯å¸Œæœ›èƒ½å¤ è®“è³‡æ–™è™•ç†çš„é€Ÿåº¦èƒ½å¤ è¶Šå¿«è¶Šå¥½ã€‚å‡è¨­ä¸€å¼µç…§ç‰‡è¦åšäººè‡‰åˆ¤æ–·çš„è©±ï¼Œæ­£å¸¸çš„åšæ³•æ˜¯è®€å–åœ–ç‰‡ï¼ˆå‡è¨­éœ€è¦èŠ±è²»æ™‚é–“ `100 ms` ) ç„¶å¾Œå°‡åœ–ç‰‡åšäººè‡‰åˆ¤æ–· ( `300 ms` ) ï¼Œæœ€å¾Œè¦å°‡è³‡æ–™å„²å­˜åœ¨è³‡æ–™åº«æˆ–æ˜¯ä¸­ä»‹åª’é«”ï¼ˆæª”æ¡ˆï¼‰ï¼ˆ`10 ms`) ã€‚é€™æ¨£å¯èƒ½ä¸€å€‹åœ–åƒæª”æ¡ˆéœ€è¦èŠ±è²» `100 + 300 +10 = 410 ms` çš„æ™‚é–“ï¼Œå¦‚æœè¦è™•å¤§é‡çš„æ•¸æ“šçš„æ™‚å€™ï¼Œé€™æ¨£çš„æ™‚é–“èŠ±è²»å°±ç„¡æ³•è¨ˆç®—ã€‚ æ‰€ä»¥é€™æ™‚å€™å°±éœ€è¦é€é goroutine èˆ‡ channel ä¾†å¤§é‡è™•ç†é€™äº›è³‡æ–™ã€‚ æ¥ä¸‹ä¾†å°±å¾é ­ä¾†ç¨å¾®è§£é‡‹ Buffered/UnBuffered Channel çš„å·®ç•°èˆ‡ä½¿ç”¨æ–¹å¼ã€‚



### Buffered/UnBuffered Channel

é€šå¸¸åœ¨è¬›è§£ goroutine èˆ‡ channel çš„æ™‚å€™ï¼Œæœ€å¸¸èˆ‡äººè¨è«–èˆ‡ç­è§£çš„å•é¡Œå°±æ˜¯ã€Œä»€éº¼æ˜¯ UnBuffered Channel ï¼Œä»€éº¼åˆæ˜¯ Buffered Channel ? å…©è€…çš„å·®ç•°èˆ‡æ‡‰ç”¨çš„åœ°æ–¹åœ¨å“ªè£¡ï¼Ÿã€ã€‚åœ¨è¬›è§£ Buffered èˆ‡ UnBuffered ä¹‹å‰ï¼Œå…ˆä¾†äº†è§£ Channel å…·æœ‰çš„åŸºæœ¬ç‰¹æ€§ï¼š

- Channels are goroutine safe
- Channels carry messages between goroutines
- FIFO semantics
- Channels cause blocking and unblocking

æ¥ä¸‹ä¾†è®“ç­†è€…é€éå¹¾å€‹ç¯„ä¾‹ä¾†è®“è®€è€…èƒ½æœ‰æ¸…æ¥šçš„äº†è§£ï¼š

é¦–å…ˆå…ˆä¾†èˆ‰å€‹ UnBuffered Channel :

<script src="https://gist.github.com/kkdai/a8ebc0ddb15e5f8f58b8ff14d1249747.js"></script>
é€™å€‹ç¯„ä¾‹å¯ä»¥åœ¨ [Playground](https://play.golang.org/p/JgviYTojtWS) ç›´æ¥åŸ·è¡Œã€‚

é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ UnBuffered Channel çš„ä½¿ç”¨ç¯„ä¾‹ï¼Œä½¿ç”¨çš„æ–¹æ³•å°±æ˜¯åœ¨ main() è£¡é¢å‘¼å«ä¸€å€‹ goroutine å»å°‡ä¸€å€‹ channel `ch` çµ¦å€¼ (send) ï¼Œè€Œæœ€å¾Œå°±åœ¨å¾ `ch` æ¥å—ï¼ˆreceive) æ•¸å€¼ã€‚

é€™é‚Šæœ‰ä¸€äº›å°åœ°æ–¹éœ€è¦æ³¨æ„ï¼š

-  ç”±æ–¼æ˜¯ UnBuffered Channel æ‰€ä»¥å‚³é€ (send) èˆ‡æ¥å— (Receive) éƒ½æœƒé€ æˆ block ï¼Œå°¤å…¶ç•¶ UnBuffered Channel å·²ç¶“åœ¨å‚³é€ä¸€å€‹æ•¸å€¼çš„æ™‚å€™ï¼Œå‚³é€ç¬¬äºŒå€‹æ•¸å€¼çš„è©±å°±æœƒé€ æˆ goroutine block å¿…é ˆç­‰å¾…æ•¸å€¼è¢«æ¥å—( Receive ) ä¹‹å¾Œæ‰èƒ½ç¹¼çºŒè™•ç†ã€‚
-  å¦‚æœåœ¨ `main()` å°æ–¼ unbuffered channel å‚³é€å€¼ (send) å»æ²’æœ‰æ¥å— ( Receive) ï¼Œå‰‡æœƒé€ æˆ deadlock detector åµæ¸¬åˆ°è€Œå ±éŒ¯ `fatal error: all goroutines are asleep - deadlock!` ï¼Œä½†æ˜¯åœ¨ goroutine è£¡é¢å»ä¸æœƒç”¢ç”ŸéŒ¯èª¤ï¼Œå› ç‚ºåªæœƒç”¢ç”Ÿ goroutine leak ã€‚ï¼ˆå‚™è¨»ï¼š å¦‚æœæœ‰å‘¼å«åˆ° `libsystem` çš„ function call ä¹Ÿä¸æœƒï¼Œå¯ä»¥åƒè€ƒ [Go issue 33004](https://github.com/golang/go/issues/33004) )
-  å¦‚æœå°æ–¼ä¸€å€‹å·²ç¶“ closed channel å»çµ¦å€¼ (send) æœƒç™¼ç”Ÿå•é¡Œï¼Œä½†æ˜¯æ‹¿å€¼åªæœƒæ‹¿å› empty value ã€‚

æ¥ä¸‹ä¾†ï¼Œå°æ–¼ Buffered Channe.l ä¹Ÿèˆ‰ä¸€å€‹ä¾‹å­ï¼š

<script src="https://gist.github.com/kkdai/a5bb1b9eed8df0cd3b154763a7761290.js"></script>
ç›¸é—œçš„ç¯„ä¾‹å¯ä»¥åœ¨ [Playground](https://play.golang.org/p/8g-ZQWoDdmi) ç›´æ¥åŸ·è¡Œã€‚

ç¬¬äºŒå€‹ç¯„ä¾‹å°±æ˜¯ä¸€å€‹ç°¡å–®çš„ Buffered Channel çš„ç¯„ä¾‹ï¼Œæ¯”å°å‰ä¸€å€‹ç¯„ä¾‹å¯ä»¥äº†è§£ Buffered Channel æ¯”èµ· UnBuffered Channel å¯ä»¥ send èˆ‡ receive æ›´å¤šæ•¸å€¼è€Œä¸éœ€è¦ wait ï¼ˆæˆ–æ˜¯èªª block) ã€‚ ä¹Ÿå› ç‚ºé€™æ¨£çš„æ–¹å¼ï¼Œå…¶å¯¦åœ¨ä½¿ç”¨ä¸Šï¼Œé€šå¸¸æœƒå»ºè­°éœ€è¦åŒæ­¥è™•ç†çš„è³‡æ–™ï¼Œå»ºè­°æ”¾åœ¨ Buffered Channel è£¡é¢ï¼Œå¯ä»¥è®“æ•¸å€‹ goroutine é‡å°ä¸€å€‹ Buffered Channel ä¾†åšè³‡æ–™çš„æ“ä½œã€‚

![](../images/2019/gopher-pipeline.png)

### Golang Pipeline pattern

æ¥ä¸‹ä¾†ä¾†è¬›è§£ä¸€å€‹ç¶“å¸¸åœ¨è³‡æ–™è™•ç†ä¸Šçš„æ–¹å¼ï¼Œå°±æ˜¯é€é channel ä¾†åš pipeline çš„è™•ç†ã€‚é€™è£¡è¦èˆ‰ä¸€å€‹åœ¨ Golang Blog: [Go Concurrency Patterns: Pipelines and cancellation](https://blog.golang.org/pipelines) è£¡é¢çš„ç¯„ä¾‹ï¼š

<script src="https://gist.github.com/kkdai/1313cb35a523c0d67bef4b4960ef859a.js"></script>
ç›¸é—œçš„ç¯„ä¾‹å¯ä»¥åœ¨ [Playground](https://play.golang.org/p/Zerr7phrGqn) ç›´æ¥åŸ·è¡Œ

é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ä¾†é€é UnBuffered Channel ä¾†å°‡è³‡æ–™é€ä¸€çš„å‚³éåˆ°å„å€‹å‡½å¼ä¹‹é–“ã€‚é€™å€‹ç¯„ä¾‹ä¸»è¦æ˜¯é€éè¼¸å…¥ä¸€é€£ä¸²çš„æ•¸å­—ï¼Œ`gen()` å°‡å…¶é€å…¥ channel ä¹‹ä¸­ï¼Œè€Œ `sq()` å°‡å…¶å¾ channel æ”¶åˆ°å¾Œï¼Œå°‡æ•¸å€¼å¹³æ–¹ä¹‹å¾Œå†é€åˆ°å¦å¤–ä¸€å€‹ channel ï¼Œè€Œæœ€å¾Œå°±æ‹¿é€™å€‹ `out` channel ä¾†å°‡æ¥å—åˆ°çš„æ•¸å€¼åˆ—å°å‡ºä¾†ã€‚

é€™å€‹ç¯„ä¾‹å¯ä»¥æ³¨æ„ä»¥ä¸‹å¹¾ä»¶äº‹æƒ…ï¼š

- pipeline ä¸­çš„æ¯å€‹å‡½å¼çš„å…±é€šæ¨£å¼éƒ½æ˜¯ï¼Œå»ºç«‹ä¸€å€‹è¼¸å‡ºçš„ channel ( `out` ) ï¼Œé€é goroutine æ¥å—è¼¸å…¥çš„ channel ( `in` )  ã€‚
- ç”±æ–¼æ˜¯é€é UnBuffered Channel ä¾†å‚³éè³‡æ–™ï¼Œæ‰€ä»¥æ¯æ¬¡åªæœ‰ä¸€å€‹æœƒè™•ç†ã€‚é€éä»¥ä¸Šçš„ç¯„ä¾‹ï¼Œæœƒå…ˆè™•ç† `2` ç„¶å¾Œå†è™•ç† `3` ã€‚

é€é Pipeline pattern åœ¨è™•ç†è³‡æ–™çš„æ™‚å€™æœ‰ä»¥ä¸‹çš„å¥½è™•ï¼š

- æ¯å€‹è™•ç†å‡½å¼å¯ä»¥å°ˆå¿ƒçš„åŠŸèƒ½éƒ¨åˆ†ã€‚
- ç”±æ–¼æ˜¯ pipeline çš„è™•ç†ï¼Œæ¯ä¸€å€‹è™•ç†çš„æ­¥é©Ÿå¯ä»¥åšç–ŠåŠ æˆ–æ˜¯é †åºèª¿æ•´ã€‚



æœ€é‡è¦çš„å°±æ˜¯å¯ä»¥é€é goroutine ä¾†è®“è³‡æ–™è™•ç†çš„ pipeline è®Šæˆå¤šç·šç¨‹ï¼ˆ multiple threading ) ï¼Œç´°ç¯€å°‡åœ¨æ¥ä¸‹ä¾†è¬›è§£ã€‚



### Advanced Pipeline patterns 

åœ¨ Pipeline çš„é€²éš pattern è£¡é¢æœ‰ä»¥ä¸‹å¹¾ç¨®ï¼š

- **Fan-In:**
  - å°‡å¤šå€‹ channel ä½µå…¥ç‚ºå–®ç¨ä¸€å€‹ channel ã€‚ä¸»è¦ç”¨æ–¼åœ¨ Fan-Out ä¹‹å¾Œï¼Œè¦å°‡è³‡æ–™çµ±ä¸€ä¸¦ä¸”æ”¶é›†å›ä¾†çš„è™•ç†æ–¹å¼ã€‚
- **Fan-Out:**
  - ç›¸åçš„ï¼Œå°±æ˜¯å°‡å–®ç¨ Channel è£¡é¢çš„è³‡æ–™åˆ†æ•£å‚³é€åˆ°å¤šå€‹ Channel è£¡é¢ï¼Œä¸»è¦ç”¨æ–¼æº–å‚™å¹³è¡Œè™•ç†çš„å‰ç½®ä½œæ¥­ã€‚

ä¸»è¦çš„æ‡‰ç”¨å ´æ™¯å°±æ˜¯ï¼Œé€é Fan-Out çš„æ–¹å¼å°‡è³‡æ–™å‚³é€åˆ°å¤šå€‹ Channel ä¹‹ä¸­ï¼Œé€™æ¨£çš„è©±å¯ä»¥é€éå€‹åˆ¥ Channel å†ä¾†ä¸²æ¥ç›¸é—œçš„ Pipeline ï¼ˆæˆ–æ˜¯å¹³è¡Œè™•ç†ç›¸åŒçš„ Pipeline ) ï¼Œæœ€å¾Œå†é€é Fan-In çš„æ–¹å¼å°‡å¹³è¡Œè™•ç†å®Œçš„è³‡æ–™æ•´ç†åˆ°ä¸€å€‹ Channel ä¹‹ä¸­ï¼Œä½œç‚ºä¹‹å¾Œçš„è³‡æ–™å„²å­˜æˆ–æ˜¯ç›¸é—œçš„è™•ç†ã€‚

ä½œç‚ºèˆ‰ä¾‹ä¸Šï¼Œ Fan-In çš„ç›¸é—œç¯„ä¾‹ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š

<script src="https://gist.github.com/kkdai/6f015023e037faf17a28e51e231489d8.js"></script>
åœ¨ [Playground](https://play.golang.org/p/VoZdosxo9AR) ä¸ŠæŸ¥çœ‹å®Œæ•´å¯ä»¥é‹è¡Œçš„ç¨‹å¼ç¢¼ã€‚

åœ¨ `merge()`çš„è™•ç†ä¸Šï¼Œæœƒä½¿ç”¨ `sync.WaitGroup` ä¾†è™•ç† goroutine è£¡é¢éœ€è¦ç­‰å¾…ä¾†æ­£ç¢ºçš„é—œé–‰ `out` ï¼Œä¸¦ä¸”é€éå¤šå€‹ `go output(c)` ä¾†é€é goroutine åˆ†åˆ¥è™•ç†è³‡æ–™çš„æ•´åˆã€‚ 

####  Explicit cancellation 

æ­¤å¤–ï¼Œé™¤äº† Fan-In èˆ‡ Fan-Out ä¹‹å¤–ï¼Œå› ç‚º Pipeline çš„è³‡æ–™è™•ç†ä¸Šç¶“å¸¸éƒ½æ˜¯éœ€è¦æ¯”è¼ƒé•·çš„æ™‚é–“ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨è™•ç†åˆ°ä¸€åŠçš„æ™‚å€™éœ€è¦å°‡æ•´å€‹æµç¨‹æš«åœæˆ–æ˜¯å–æ¶ˆçš„æƒ…æ³ã€‚é€™æ™‚å€™æœƒéœ€è¦ä½¿ç”¨ Explicit cancellation çš„æ–¹å¼ï¼Œæ‹¿å‰ä¸€æ®µçš„ `merge()`åšä¸€äº›ä»¥ä¸‹çš„ä¿®æ”¹ï¼š

<script src="https://gist.github.com/kkdai/5ebd101a40a2472301a6a16f40d36918.js"></script>
å®Œæ•´å¯åŸ·è¡Œçš„ç¨‹å¼ç¢¼å¯ä»¥åœ¨ [Playground](https://play.golang.org/p/Zwy6mZgWvE9) è£¡é¢çœ‹åˆ°ã€‚

é€éé€™æ®µä»£ç¢¼å¯ä»¥äº†è§£ï¼Œå‚³å…¥çš„åƒæ•¸ `done chan struct{}` ä¸»è¦å°±æ˜¯é€é UnBuffered channel ä¾†åšé‚è¼¯çš„æ§åˆ¶ï¼Œè€Œå…¶ä¸­çš„:

```
for n := range c {
            select {
            case out <- n:
            case <-done:
            }
        }
```

æ›´æ˜¯ä¸»è¦æ§åˆ¶æ˜¯å¦è¦åœæ­¢çš„é‚è¼¯åˆ¤æ–·ï¼Œ `select` åœ¨ Go è£¡é¢çš„ç”¨æ³•ç›¸ç•¶æœ‰å½ˆæ€§ï¼Œé™¤äº†å¯ä»¥åšæƒ…æ³çš„åˆ¤æ–·ä¹‹å¤–ï¼Œæ›´å¯ä»¥æœ‰å¤šæ¨£çš„ Pattern å¯ä»¥ä½¿ç”¨ï¼Œå…¶ä¸­é€™å€‹ç¯„ä¾‹å°±æ˜¯æœ€å¸¸åœ¨ goroutine è£¡é¢æœƒä½¿ç”¨åˆ°çš„ã€‚æœ‰å…©ç¨®ç‹€æ³å¯ä»¥åˆ¤æ–·ï¼Œè€Œ `select` è‡ªå‹•æœƒèµ°åˆ°ä¸é€ æˆ block çš„é‚£å€‹åˆ¤æ–·å¼ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœç•¶ `done` channel è£¡é¢æœ‰æ•¸å€¼å¯ä»¥æ¥æ”¶çš„è©±ï¼Œé‚£éº¼å°±ä¸æœƒç­‰å¾… `out` channel æ•¸å€¼æ¥æ”¶ã€‚



### å¥½ç”¨çš„ pipeline package -  Go-kit

https://github.com/go-kit/kit æ˜¯ä¸€å€‹å¾ˆå¥½ç”¨çš„å¥—ä»¶å·¥å…·ï¼Œè£¡é¢æä¾›äº†è¨±å¤šæœ‰ç”¨çš„å°å·¥å…·ï¼ŒåŒ…æ‹¬äº† [circuitbreaker](https://github.com/go-kit/kit/tree/master/circuitbreaker) ï¼Œ[ratelimit](https://github.com/go-kit/kit/tree/master/ratelimit) ç­‰ç­‰æœ‰ç”¨çš„å·¥å…·ã€‚ ä½†æ˜¯å…¶å¯¦è£¡é¢æœ‰ä¸€å€‹å¥½ç”¨çš„ pipeline å¥—ä»¶ç¨±ç‚º [endpoint](https://github.com/go-kit/kit/tree/master/endpoint) ã€‚

é€™é‚Šæœ‰ä¸€æ®µç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œåœ¨ [Playground](https://play.golang.org/p/_WDD1L6RwJT) å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ go-kit çš„ [endpoint](https://github.com/go-kit/kit/tree/master/endpoint) å¥—ä»¶ï¼Œä¾†å¯¦åšä¸€å€‹ç°¡å–®çš„ pipeline çš„åŠŸèƒ½ã€‚ é€™é‚Šå¯èƒ½è®€è€…ä¹Ÿæœƒç™¼ç¾ï¼š ä»€éº¼æ™‚å€™é–‹å§‹ä¹Ÿå¯ä»¥åœ¨  [Playground](https://play.golang.org/p/_WDD1L6RwJT)  ä½¿ç”¨ 3rd party çš„å¥—ä»¶å‘¢ï¼Ÿ

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">The <a href="https://twitter.com/hashtag/golang?src=hash&amp;ref_src=twsrc%5Etfw">#golang</a> playground now supports third-party imports, pulling them in via <a href="https://t.co/IrUZXimjCk">https://t.co/IrUZXimjCk</a> ... <a href="https://t.co/5Ng5JXpggq">https://t.co/5Ng5JXpggq</a> ğŸ‰<br><br>Multi-file support &amp; few other things up next.<br><br>Report bugs at <a href="https://t.co/kZELNa2yzY">https://t.co/kZELNa2yzY</a> or here on the tweeters.</p>&mdash; Brad Fitzpatrick (@bradfitz) <a href="https://twitter.com/bradfitz/status/1128069715455123457?ref_src=twsrc%5Etfw">May 13, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
æ ¹æ“šé€™å€‹ [tweet](https://twitter.com/bradfitz/status/1128069715455123457) ï¼ŒåŸä¾† 2019 çš„äº”æœˆä¹‹å¾Œ [Playgound](https://play.golang.org) çš„åŠŸèƒ½æœ‰æ›´æ–°éå·²ç¶“æ”¯æ´ thrid-party import äº†ã€‚é€™æ¨£é€é [Playground](https://play.golang.org) ä¾†è¨è«–å•é¡Œä¹Ÿå°±è®Šå¾—æ›´æ–¹ä¾¿ã€‚

### Go-kit endpoint Pipeline + Buffered Channel 

æœ€å¾Œè®“é€é Go-kit çš„ endpoint çš„ pipeline å¥—ä»¶èˆ‡ Buffered Channel çš„æ¦‚å¿µï¼Œä¾†å¯¦åšä¸€å€‹ç°¡å–®çš„è®€å–åœ–ç‰‡çš„ Pipeline ã€‚

<script src="https://gist.github.com/kkdai/73c61f168aede0eced747f6c88485e8c.js"></script>
é€™å€‹ç¯„ä¾‹ç¨‹å¼ç¢¼é€éè¼¸å…¥çš„ `numOfImageReaders` ä¾†åœ¨åˆ¤æ–·éœ€è¦å¤šå°‘çš„ goroutine ä¾†è™•ç†ç›¸é—œçš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ `ImageReader(in, out)` ã€‚ä¸¦ä¸”é è¨­ Buffered Channel çš„å¤§å°æ˜¯ 1000 ä¾†è®“æ‰€æœ‰çš„è³‡æ–™éƒ½å¯ä»¥é¦¬ä¸Šè¢«è™•ç†è€Œä¸éœ€è¦ç­‰ pipeline å¾Œç«¯è™•ç†å®Œç•¢ã€‚

### å°çµï¼š

æœ¬æ–‡é€éä»‹ç´¹ Buffered/UnBuffered Channel çš„ä»‹ç´¹ä¾†è©³ç´°è§£é‡‹ Pipeline pattern ä¸¦ä¸”é€éä¸€å€‹å¯¦å‹™ä¸Šçš„æ¡ˆä¾‹ï¼ˆç…§ç‰‡çš„è³‡æ–™è®€å–èˆ‡è™•ç†ï¼‰ä¾†è§£é‡‹å¦‚ä½•æ‡‰ç”¨ Channel ä¾†å®Œæˆ Pipeline ã€‚




### æ›´å¤šç›¸é—œå…§å®¹:

- Go Concurrency Patterns: Pipelines and cancellation https://blog.golang.org/pipelines

- Advanced Go Concurrency Patterns https://blog.golang.org/advanced-go-concurrency-patterns

- Understanding Channels 
	- https://about.sourcegraph.com/go/understanding-channels-kavya-joshi
	- https://www.youtube.com/watch?v=KBZlN0izeiY
	
- [Go: issue 33004 - Deadlock detector will disable when use Mac OSX (channel with net.http, no deadlock, why)](https://github.com/golang/go/issues/33004) 

  - [Go Issue 29322 runtime: PIEs don't detect deadlocks #29322](https://github.com/golang/go/issues/29322)

  

## Refactoring in Goland for beginner / Julian Chu

æœ¬æ–‡ä¸»è¦æ˜¯é€é JetBrains çš„ç”¢å“ Goland ä¾†å¿«é€Ÿåœ°å¹«åŠ©é–‹ç™¼è€…åšé‡æ§‹ (Refactoring) çš„ç›¸é—œå·¥ä½œã€‚ ç›¸é—œçš„å½±ç‰‡æ¢åˆ—å¦‚ä¸‹ï¼š

- https://youtu.be/oCgoxqDS2tM 
  - åˆ©ç”¨GoLandé‡æ§‹ï¼Œ æœ€å¾Œé¢åˆ©ç”¨moveé€™å€‹é‡æ§‹æŠŠstructè·Ÿmethodæ¬åˆ°å…¶ä»–package (moveä¸Šæ¬¡æ²’demoåˆ°)
- https://youtu.be/QTgpVx4bVbk 
  - åˆ©ç”¨test + auto completeç”Ÿæˆstructè·Ÿmethod

æ•´ç†ä¸€ä¸‹ç›¸é—œå•é¡Œ:

- GoLandæ€éº¼åˆ‡æ›tab:
  - GoLand(alt + left/right, æˆ–ctrl+tab)
  - VScode(ctrl + page up/down)
  - vim/VScodeVim/ideavim( g + t/T)
- GoLandå¯ä»¥è‡ªå‹•è¼‰å…¥vimrcå—é‚„æ˜¯ä¸€å®šè¦source:
  - å¯ä»¥ï¼Œä¸éè·¯å¾‘è·Ÿåå­—æœ‰é™åˆ¶ï¼Œideavimæœƒè‡ªå‹•è¼‰å…¥`~/.ideavimrc`ã€€
  - æ›´å¤šç´°ç¯€åœ¨
    https://github.com/JetBrains/ideavim#files

ç›¸é—œè²¼æ–‡å¯ä»¥åƒè€ƒï¼š

- https://www.facebook.com/groups/269001993248363/permalink/1388935217921696/
- https://www.facebook.com/groups/269001993248363/permalink/1384468938368324/



## æ´»å‹•å°çµ

æ¯æ¬¡åˆ°æŠ•å½±ç‰‡éˆæ„Ÿæ¯ç«­çš„æ™‚å€™ï¼Œå°±æœƒå› Go Taipei Community å»å–æš–ã€‚å»è¬›ä¸€å ´æŠ€è¡“åˆ†äº«æœƒè®“æˆ‘è¦ºå¾—æ ¼å¤–çš„å¿ƒæƒ…é–‹æœ—ï¼Œæ„Ÿè¬ç•¶å¤©çš„å¤¥ä¼´å€‘ç†±æƒ…çš„è¨è«–ï¼Œä¹Ÿæ­¡è¿å¤§å®¶ä¸€èµ·ä¾†äº†è§£ã€‚

èº«ç‚º Golang.TW çš„å…±åŒç±Œè¾¦äººï¼ŒçœŸçš„å¾ˆä¹…æ²’æœ‰å›åˆ°ç¤¾ç¾¤ä¾†å–®ç´”çš„çµ¦ä¸€å ´æŠ€è¡“çš„åˆ†äº«ã€‚è—‰ç”±é€™æ¬¡æ©Ÿæœƒé™¤äº†èƒ½å¤ åˆ†äº«ä¹‹å¤–ï¼Œä¹Ÿèƒ½é †ä¾¿å›ä¾†ç¤¾ç¾¤çœ‹çœ‹å¥½ä¹…ä¸è¦‹å¾—å¤¥ä¼´å€‘ã€‚ 



ç«‹å³åŠ å…¥ã€ŒLINEé–‹ç™¼è€…å®˜æ–¹ç¤¾ç¾¤ã€å®˜æ–¹å¸³è™Ÿï¼Œå°±èƒ½æ”¶åˆ°ç¬¬ä¸€æ‰‹Meetupæ´»å‹•ï¼Œæˆ–èˆ‡é–‹ç™¼è€…è¨ˆç•«æœ‰é—œçš„æœ€æ–°æ¶ˆæ¯çš„æ¨æ’­é€šçŸ¥ã€‚â–¼

ã€ŒLINEé–‹ç™¼è€…å®˜æ–¹ç¤¾ç¾¤ã€å®˜æ–¹å¸³è™ŸIDï¼š@line_tw_dev

## é—œæ–¼ã€ŒLINEé–‹ç™¼ç¤¾ç¾¤è¨ˆç•«ã€

LINEä»Šå¹´å¹´åˆåœ¨å°ç£å•Ÿå‹•ã€ŒLINEé–‹ç™¼ç¤¾ç¾¤è¨ˆç•«ã€ï¼Œå°‡é•·æœŸæŠ•å…¥äººåŠ›èˆ‡è³‡æºåœ¨å°ç£èˆ‰è¾¦å°å…§å°å¤–ã€ç·šä¸Šç·šä¸‹çš„é–‹ç™¼è€…ç¤¾ç¾¤èšæœƒã€å¾µæ‰æ—¥ã€é–‹ç™¼è€…å¤§æœƒç­‰ï¼Œé è¨ˆå…¨å¹´å°‡èˆ‰è¾¦30å ´ä»¥ä¸Šçš„æ´»å‹•ã€‚æ­¡è¿è®€è€…å€‘èƒ½å¤ æŒçºŒå›ä¾†å¯Ÿçœ‹æœ€æ–°çš„ç‹€æ³ã€‚è©³æƒ…è«‹çœ‹ [2019 å¹´LINE é–‹ç™¼ç¤¾ç¾¤è¨ˆç•«æ´»å‹•æ™‚ç¨‹è¡¨ (æŒçºŒæ›´æ–°)](https://engineering.linecorp.com/zh-hant/blog/line-taiwan-developer-relations-2019-plan/)https://engineering.linecorp.com/zh-hant/blog/line-taiwan-developer-relations-2019-plan/)