---
layout: post
title: "[Google ADK][A2A] LINE Bot æ¶æ§‹å¤§æ”¹é€ ï¼šå¾ if/elif åœ°ç„åˆ° Multi-Agent Orchestration"
description: "ä½¿ç”¨ Google Agent Development Kit (ADK) é‡æ§‹ LINE Botï¼Œå¯¦ç¾ Agent-to-Agent (A2A) é€šè¨Šæ¶æ§‹"
category:
- TIL
tags: ["Python", "Google ADK", "A2A", "LINE Bot", "Multi-Agent", "Vertex AI"]

---


| åœ–ç‰‡ A | åœ–ç‰‡ B |
| :---: | :---: |
| ![LINE 2026-01-24 21.37.25](../images/LINE%202026-01-24%2021.37.25.png) | <img src="../images/LINE%202026-01-24%2021.37.16.png" alt="LINE 2026-01-24 21.37.16"  /> |

# å‰æƒ…æè¦

åœ¨ç¶­è­· [linebot-helper-python](https://github.com/kkdai/linebot-helper-python) å°ˆæ¡ˆæ™‚ï¼Œæˆ‘ä¸€ç›´é¢è‡¨ä¸€å€‹æ¶æ§‹å•é¡Œï¼šéš¨è‘—åŠŸèƒ½å¢åŠ ï¼Œ`main.py` ä¸­çš„ `if/elif` åˆ¤æ–·å¼è¶Šä¾†è¶Šé•·ï¼Œç¨‹å¼ç¢¼è¶Šä¾†è¶Šé›£ç¶­è­·ã€‚

**åŸæœ¬çš„è¨Šæ¯è·¯ç”±é‚è¼¯ï¼š**

```python
# âŒ èˆŠç‰ˆ - if/elif åœ°ç„
async def handle_text_message(event):
    msg = event.message.text

    if msg.startswith('/clear'):
        # è™•ç†æ¸…é™¤æŒ‡ä»¤
    elif msg.startswith('/help'):
        # è™•ç†èªªæ˜æŒ‡ä»¤
    elif msg == '@g':
        # è™•ç† GitHub æ‘˜è¦
    elif is_youtube_url(msg):
        # è™•ç† YouTube æ‘˜è¦
    elif extract_url(msg):
        # è™•ç†ä¸€èˆ¬ URL æ‘˜è¦
    else:
        # è™•ç†ä¸€èˆ¬å°è©±
```

é€™æ¨£çš„æ¶æ§‹æœ‰å¹¾å€‹æ˜é¡¯å•é¡Œï¼š

**âŒ é›£ä»¥ç¶­è­·** - æ–°å¢åŠŸèƒ½å°±è¦åŠ  elifï¼Œæª”æ¡ˆè¶Šä¾†è¶Šè‚¥
**âŒ é›£ä»¥æ¸¬è©¦** - æ‰€æœ‰é‚è¼¯æ··åœ¨ä¸€èµ·ï¼Œå–®å…ƒæ¸¬è©¦å›°é›£
**âŒ é›£ä»¥æ“´å±•** - æƒ³è¦ä¸¦è¡Œè™•ç†å¤šå€‹æ„åœ–ï¼Ÿæ”¹èµ·ä¾†å¾ˆç—›è‹¦
**âŒ è·è²¬ä¸æ¸…** - å°è©±ã€æ‘˜è¦ã€ä½ç½®æœå°‹å…¨éƒ¨æ··åœ¨ä¸€èµ·

åœ¨ 2025 å¹´åˆï¼ŒGoogle ç™¼å¸ƒäº† [Agent Development Kit (ADK)](https://google.github.io/adk-docs/)ï¼Œæä¾›äº†å»ºæ§‹ Multi-Agent ç³»çµ±çš„æ¡†æ¶ã€‚æˆ‘æ±ºå®šç”¨ ADK é‡æ§‹æ•´å€‹å°ˆæ¡ˆï¼Œå¯¦ç¾ Agent-to-Agent (A2A) æ¶æ§‹ã€‚

é€™ç¯‡æ–‡ç« è¨˜éŒ„äº†å®Œæ•´çš„é·ç§»éç¨‹ï¼Œå¾è¦åŠƒåˆ°å¯¦ä½œçš„ 5 å€‹éšæ®µã€‚

## ä»€éº¼æ˜¯ ADK å’Œ A2Aï¼Ÿ

### Google Agent Development Kit (ADK)

ADK æ˜¯ Google æä¾›çš„ Python æ¡†æ¶ï¼Œç”¨æ–¼å»ºæ§‹åŸºæ–¼ LLM çš„ Agent ç³»çµ±ï¼š

```python
from google.adk.agents import Agent

chat_agent = Agent(
    name="chat_agent",
    model="gemini-2.5-flash",
    description="è™•ç†ä¸€èˆ¬å°è©±",
    instruction="ä½ æ˜¯ä¸€å€‹æ™ºèƒ½åŠ©æ‰‹...",
    tools=[google_search_tool],
)
```

### Agent-to-Agent (A2A) é€šè¨Š

A2A æ˜¯ä¸€ç¨®æ¶æ§‹æ¨¡å¼ï¼Œè®“å¤šå€‹å°ˆæ¥­ Agent å”ä½œè™•ç†è¤‡é›œä»»å‹™ï¼š

```
User: "å¹«æˆ‘æ‰¾å°åŒ—å¥½åƒçš„æ‹‰éºµï¼Œç„¶å¾Œæ‘˜è¦é€™ç¯‡æ–‡ç«  https://..."
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Orchestrator Agent â”‚
          â”‚  (æ„åœ–è§£æ + è·¯ç”±)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Parallel Dispatch (A2A) â”‚
      â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LocationAgent â”‚          â”‚ContentAgent  â”‚
â”‚ Task: æ‰¾æ‹‰éºµ  â”‚          â”‚ Task: æ‘˜è¦URLâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
               å½™æ•´å›è¦†çµ¦ç”¨æˆ¶
```

---

## é·ç§»å‰çš„æ¶æ§‹åˆ†æ

### ç¾æœ‰æ¶æ§‹æ‘˜è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     é …ç›®     â”‚                        ç¾æ³                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¡†æ¶         â”‚ FastAPI + LINE Bot SDK                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AI å¼•æ“      â”‚ Google Vertex AI (google-genai SDK)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Session ç®¡ç† â”‚ è‡ªå»º ChatSessionManager (è¨˜æ†¶é«”å…§)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¨Šæ¯è·¯ç”±     â”‚ if/elif æ¢ä»¶åˆ¤æ–·å¼                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¥å…·æ•´åˆ     â”‚ Grounding (Google Search)ã€Mapsã€YouTubeã€ç¶²é æŠ“å– â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯è¡Œæ€§è©•ä¼°çµè«–

âœ… **å®Œå…¨å¯è¡Œ** - å°ˆæ¡ˆå·²ç¶“ä½¿ç”¨ Google Vertex AI å’Œ google-genai SDKï¼Œé€™æ­£æ˜¯ ADK çš„åŸºç¤ã€‚è½‰æ›éœ€è¦çš„æ˜¯é‡æ§‹æ¶æ§‹è€Œéé‡å¯«é‚è¼¯ã€‚

---

## ç›®æ¨™æ¶æ§‹è¨­è¨ˆ

### Agent æ‹†åˆ†è¦åŠƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Orchestrator Agent                        â”‚
â”‚  (æ¥æ”¶ LINE è¨Šæ¯ï¼Œæ±ºå®šè·¯ç”±åˆ°å“ªå€‹å°ˆå®¶ Agent)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚                    â”‚
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Agent     â”‚  â”‚  Content Agent  â”‚  â”‚  Location Agent â”‚
â”‚  (å°è©±å¼å•ç­”)    â”‚  â”‚  (å…§å®¹æ‘˜è¦)      â”‚  â”‚  (åœ°é»æœå°‹)      â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚  Tools:         â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚
â”‚  - GoogleSearch â”‚  â”‚  - URLLoader    â”‚  â”‚  - MapsGroundingâ”‚
â”‚  - Grounding    â”‚  â”‚  - YouTubeFetch â”‚  â”‚  - PlaceSearch  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - PDFLoader    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚  - Summarizer   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â–¼                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Vision    â”‚     â”‚ GitHub    â”‚
              â”‚ Agent     â”‚     â”‚ Agent     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent è·è²¬å°ç…§è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ç¾æœ‰æ¨¡çµ„              â”‚       è½‰æ›å¾Œ Agent       â”‚                 è·è²¬                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handle_text_message()             â”‚ ChatAgent                â”‚ è™•ç†ä¸€èˆ¬å°è©±ã€Google Search Grounding â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handle_url_message() + load_url() â”‚ ContentAgent             â”‚ URL å…§å®¹æŠ“å–èˆ‡æ‘˜è¦                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ load_transcript_from_youtube()    â”‚ ContentAgent             â”‚ YouTube å½±ç‰‡æ‘˜è¦                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handle_location_message()         â”‚ LocationAgent            â”‚ åœ°é»æœå°‹èˆ‡æ¨è–¦                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handle_image_message()            â”‚ VisionAgent              â”‚ åœ–ç‰‡åˆ†æ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handle_github_summary()           â”‚ GitHubAgent              â”‚ GitHub Issues æ‘˜è¦                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ChatSessionManager                â”‚ SessionManager           â”‚ è·¨ Agent çš„å°è©±è¨˜æ†¶                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®æ¨™å°ˆæ¡ˆçµæ§‹

```
linebot-helper-python/
â”œâ”€â”€ main.py                      # FastAPI + LINE webhook (ä¿ç•™)
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ orchestrator.py          # ä¸»æ§ Agent (è·¯ç”±æ±ºç­–)
â”‚   â”œâ”€â”€ chat_agent.py            # å°è©± Agent
â”‚   â”œâ”€â”€ content_agent.py         # å…§å®¹æ‘˜è¦ Agent
â”‚   â”œâ”€â”€ location_agent.py        # åœ°é»æœå°‹ Agent
â”‚   â”œâ”€â”€ vision_agent.py          # åœ–ç‰‡åˆ†æ Agent
â”‚   â””â”€â”€ github_agent.py          # GitHub Agent
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ url_loader.py            # å¾ loader/url.py é‡æ§‹
â”‚   â”œâ”€â”€ youtube_tool.py          # å¾ loader/youtube_gcp.py é‡æ§‹
â”‚   â”œâ”€â”€ maps_tool.py             # å¾ loader/maps_grounding.py é‡æ§‹
â”‚   â”œâ”€â”€ summarizer.py            # å¾ loader/langtools.py é‡æ§‹
â”‚   â””â”€â”€ pdf_tool.py              # å¾ loader/pdf.py é‡æ§‹
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ session_manager.py       # Session ç®¡ç†æœå‹™
â”‚   â””â”€â”€ line_service.py          # LINE API å°è£
â”œâ”€â”€ config/
â”‚   â””â”€â”€ agent_config.py          # Agent è¨­å®šèˆ‡ Model é¸æ“‡
â””â”€â”€ loader/                      # ä¿ç•™èˆŠç‰ˆç›¸å®¹
```

---

## é·ç§»è¨ˆç•«ï¼š5 å€‹éšæ®µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éšæ®µ   â”‚                            å·¥ä½œå…§å®¹                             â”‚ é ä¼°é¢¨éšª â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 1 â”‚ å®‰è£ ADKã€å»ºç«‹ tools/ ç›®éŒ„ï¼Œå°‡ loader/*.py é‡æ§‹ç‚º ADK Tool æ ¼å¼ â”‚ ä½é¢¨éšª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 2 â”‚ å»ºç«‹ ChatAgentï¼Œé©—è­‰èˆ‡ LINE webhook æ•´åˆ                        â”‚ ä¸­é¢¨éšª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 3 â”‚ å»ºç«‹å…¶ä»–å°ˆæ¥­ Agent (Content, Location, Vision, GitHub)          â”‚ ä¸­é¢¨éšª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 4 â”‚ å»ºç«‹ Orchestratorï¼Œå¯¦ä½œ A2A è·¯ç”±é‚è¼¯                            â”‚ é«˜é¢¨éšª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 5 â”‚ é·ç§» Session ç®¡ç†ã€æ¸¬è©¦å®Œæ•´æµç¨‹                                 â”‚ ä¸­é¢¨éšª   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: å®‰è£ ADK èˆ‡é‡æ§‹ Tools

### ç›®æ¨™

å°‡ç¾æœ‰çš„ `loader/` æ¨¡çµ„é‡æ§‹ç‚º ADK ç›¸å®¹çš„ Tool æ ¼å¼ã€‚

### å¯¦ä½œå…§å®¹

**1. å®‰è£ ADK ä¾è³´**

```bash
# requirements.txt
google-adk>=1.0.0
```

**2. å»ºç«‹ tools/ ç›®éŒ„çµæ§‹**

```python
# tools/summarizer.py
"""ADK-compatible summarization tools"""

def summarize_text(text: str, mode: str = "normal") -> dict:
    """
    Summarize text content using Gemini.

    Args:
        text: Content to summarize
        mode: "normal", "detailed", or "twitter"

    Returns:
        dict with 'status' and 'summary' keys
    """
    # å¯¦ä½œæ‘˜è¦é‚è¼¯...
    return {"status": "success", "summary": result}


def analyze_image(image_data: bytes, prompt: str) -> dict:
    """
    Analyze image using Gemini multimodal.

    Args:
        image_data: Image bytes
        prompt: Analysis prompt

    Returns:
        dict with 'status' and 'analysis' keys
    """
    # å¯¦ä½œåœ–ç‰‡åˆ†æé‚è¼¯...
    return {"status": "success", "analysis": result}
```

**3. é‡æ§‹çš„å·¥å…·æ¨¡çµ„**

| åŸå§‹æ¨¡çµ„ | æ–°å·¥å…·æ¨¡çµ„ | åŠŸèƒ½ |
|---------|-----------|------|
| `loader/langtools.py` | `tools/summarizer.py` | æ–‡å­—æ‘˜è¦ã€åœ–ç‰‡åˆ†æ |
| `loader/youtube_gcp.py` | `tools/youtube_tool.py` | YouTube å½±ç‰‡æ‘˜è¦ |
| `loader/maps_grounding.py` | `tools/maps_tool.py` | åœ°é»æœå°‹ |
| `loader/pdf.py` | `tools/pdf_tool.py` | PDF è™•ç† |
| `loader/url.py` | `tools/url_loader.py` | URL å…§å®¹æŠ“å– |

### æˆæœ

- PR #10 merged
- Release v0.3.0

---

## Phase 2: å»ºç«‹ ChatAgent èˆ‡ LINE æ•´åˆ

### ç›®æ¨™

å»ºç«‹ç¬¬ä¸€å€‹ ADK Agentï¼Œè™•ç†ä¸€èˆ¬å°è©±ä¸¦æ•´åˆ Google Search Groundingã€‚

### å¯¦ä½œå…§å®¹

**1. å»ºç«‹ Agent é…ç½®**

```python
# config/agent_config.py
@dataclass
class AgentConfig:
    """Configuration for ADK agents"""

    # Vertex AI settings
    project_id: str
    location: str

    # Model settings
    chat_model: str = "gemini-2.5-flash"
    orchestrator_model: str = "gemini-2.5-pro"
    fast_model: str = "gemini-2.5-flash-lite"

    # Session settings
    session_timeout_minutes: int = 30
    max_history_length: int = 20

    # Feature flags
    enable_grounding: bool = True
    enable_maps_grounding: bool = True
```

**2. å»ºç«‹ ChatAgent**

```python
# agents/chat_agent.py
from google.adk.agents import Agent

CHAT_AGENT_INSTRUCTION = """ä½ æ˜¯ä¸€å€‹æ™ºèƒ½åŠ©æ‰‹ï¼Œå°ˆé–€å›ç­”ç”¨æˆ¶çš„å•é¡Œã€‚

## å›æ‡‰åŸå‰‡
1. ä½¿ç”¨å°ç£ç”¨èªçš„ç¹é«”ä¸­æ–‡å›ç­”
2. å¦‚æœéœ€è¦æœ€æ–°è³‡è¨Šï¼Œè«‹æœå°‹ç¶²è·¯ä¸¦æä¾›æº–ç¢ºçš„ç­”æ¡ˆ
3. å›ç­”è¦ç°¡æ½”ä½†å®Œæ•´ï¼Œé©åˆåœ¨ LINE è¨Šæ¯ä¸­é–±è®€
"""

class ChatAgent:
    def __init__(self, config: AgentConfig):
        self.config = config
        self.sessions: Dict[str, dict] = {}

        # Initialize ADK agent
        self.adk_agent = Agent(
            name="chat_agent",
            model=config.chat_model,
            description="å°è©±å¼å•ç­” Agent",
            instruction=CHAT_AGENT_INSTRUCTION,
            tools=[],
        )

    async def chat(self, user_id: str, message: str) -> dict:
        """Process a chat message and return response"""
        chat, history = self.get_or_create_session(user_id)
        response = chat.send_message(message)
        return {
            'status': 'success',
            'answer': response.text,
            'sources': self._extract_sources(response),
            'has_history': len(history) > 0
        }
```

**3. å»ºç«‹ LINE Service å°è£**

```python
# services/line_service.py
class LineService:
    """Wrapper for LINE Bot API operations"""

    @staticmethod
    def format_error_message(error: Exception, action: str) -> str:
        """Format user-friendly error message"""
        error_str = str(error)
        if "quota" in error_str.lower():
            return f"âš ï¸ {action}æ™‚ API é¡åº¦ä¸è¶³ï¼Œè«‹ç¨å¾Œå†è©¦"
        elif "timeout" in error_str.lower():
            return f"âš ï¸ {action}æ™‚é€£ç·šé€¾æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦"
        else:
            return f"âš ï¸ {action}æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦"
```

### æˆæœ

- PR #11 merged
- Release v0.4.0

---

## Phase 3: å»ºç«‹å°ˆæ¥­ Agents

### ç›®æ¨™

å»ºç«‹ ContentAgentã€LocationAgentã€VisionAgentã€GitHubAgentã€‚

### å¯¦ä½œå…§å®¹

**1. ContentAgent - å…§å®¹æ‘˜è¦**

```python
# agents/content_agent.py
class ContentAgent:
    """Agent for URL content summarization"""

    async def process_url(self, url: str, mode: str = "normal") -> dict:
        """Process any URL and return summary"""
        if self._is_youtube_url(url):
            return await self.summarize_youtube(url, mode)
        elif self._is_pdf_url(url):
            return await self.summarize_pdf(url, mode)
        else:
            return await self.summarize_webpage(url, mode)

    async def summarize_youtube(self, url: str, mode: str) -> dict:
        """Summarize YouTube video"""
        transcript = get_youtube_transcript(url)
        summary = summarize_text(transcript, mode)
        return {"status": "success", "summary": summary}
```

**2. LocationAgent - åœ°é»æœå°‹**

```python
# agents/location_agent.py
class LocationAgent:
    """Agent for location-based searches"""

    async def search(
        self,
        latitude: float,
        longitude: float,
        place_type: Literal["gas_station", "parking", "restaurant"]
    ) -> dict:
        """Search for nearby places"""
        result = search_nearby_places(
            latitude=latitude,
            longitude=longitude,
            place_type=place_type,
            language_code="zh-TW"
        )
        return result
```

**3. VisionAgent - åœ–ç‰‡åˆ†æ**

```python
# agents/vision_agent.py
class VisionAgent:
    """Agent for image analysis"""

    async def analyze(self, image_data: bytes, prompt: str = None) -> dict:
        """Analyze an image"""
        analysis_prompt = prompt or DEFAULT_IMAGE_PROMPT
        result = analyze_image(image_data, analysis_prompt)
        return result
```

**4. GitHubAgent - GitHub æ•´åˆ**

```python
# agents/github_agent.py
class GitHubAgent:
    """Agent for GitHub operations"""

    def get_issues_summary(self) -> dict:
        """Get summary of open GitHub issues"""
        issues = fetch_github_issues()
        summary = format_issues_summary(issues)
        return {"status": "success", "summary": summary}
```

### æˆæœ

- PR #12 merged
- Release v0.5.0

---

## Phase 4: å»ºç«‹ Orchestrator èˆ‡ A2A è·¯ç”±

### ç›®æ¨™

å»ºç«‹ä¸»æ§ Orchestratorï¼Œå¯¦ç¾æ„åœ–åµæ¸¬å’Œ Agent è·¯ç”±ã€‚

### å¯¦ä½œå…§å®¹

**1. å®šç¾©æ„åœ–é¡å‹**

```python
# agents/orchestrator.py
class IntentType(Enum):
    """Types of user intents"""
    CHAT = "chat"                    # ä¸€èˆ¬å°è©±
    URL_SUMMARY = "url_summary"      # URL æ‘˜è¦
    YOUTUBE_SUMMARY = "youtube"      # YouTube æ‘˜è¦
    IMAGE_ANALYSIS = "image"         # åœ–ç‰‡åˆ†æ
    LOCATION_SEARCH = "location"     # åœ°é»æœå°‹
    GITHUB_SUMMARY = "github"        # GitHub æ“ä½œ
    COMMAND = "command"              # ç³»çµ±æŒ‡ä»¤
    UNKNOWN = "unknown"
```

**2. Orchestrator ä¸»é¡åˆ¥**

```python
class Orchestrator:
    """Main controller for A2A routing"""

    def __init__(self, config: AgentConfig):
        # Initialize all specialized agents
        self.chat_agent = create_chat_agent(config)
        self.content_agent = create_content_agent(config)
        self.location_agent = create_location_agent(config)
        self.vision_agent = create_vision_agent(config)
        self.github_agent = create_github_agent(config)

        # URL patterns for intent detection
        self._url_pattern = re.compile(r'https?://[^\s]+')
        self._youtube_pattern = re.compile(r'https?://(?:www\.)?(?:youtube\.com|youtu\.be)')

    def detect_intents(self, message: str) -> List[Intent]:
        """Detect user intents from message"""
        intents = []

        # Check for commands
        if message.lower() in ['/clear', '/help', '/status']:
            return [Intent(IntentType.COMMAND, 1.0, {'command': message})]

        # Check for GitHub command
        if message == '@g':
            return [Intent(IntentType.GITHUB_SUMMARY, 1.0, {})]

        # Check for URLs
        urls = self._url_pattern.findall(message)
        for url in urls:
            if self._youtube_pattern.match(url):
                intents.append(Intent(IntentType.YOUTUBE_SUMMARY, 0.95, {'url': url}))
            else:
                intents.append(Intent(IntentType.URL_SUMMARY, 0.95, {'url': url}))

        # Default to chat
        if not intents:
            intents.append(Intent(IntentType.CHAT, 0.9, {'message': message}))

        return intents
```

**3. A2A è·¯ç”±é‚è¼¯**

```python
async def process_text(self, user_id: str, message: str) -> OrchestratorResult:
    """Process text message with A2A routing"""
    intents = self.detect_intents(message)

    # Single intent
    if len(intents) == 1:
        result = await self._route_intent(user_id, intents[0])
        return OrchestratorResult(success=True, responses=[result], intents=intents)

    # Multiple intents - parallel execution!
    tasks = [self._route_intent(user_id, intent) for intent in intents]
    results = await asyncio.gather(*tasks, return_exceptions=True)

    return OrchestratorResult(success=True, responses=results, intents=intents)

async def _route_intent(self, user_id: str, intent: Intent) -> dict:
    """Route single intent to appropriate agent"""
    if intent.type == IntentType.CHAT:
        return await self.chat_agent.chat(user_id, intent.data['message'])
    elif intent.type == IntentType.YOUTUBE_SUMMARY:
        return await self.content_agent.summarize_youtube(intent.data['url'])
    elif intent.type == IntentType.URL_SUMMARY:
        return await self.content_agent.process_url(intent.data['url'])
    # ... å…¶ä»–è·¯ç”±
```

**4. æ›´æ–° main.py ä½¿ç”¨ Orchestrator**

```python
# main.py
from agents import create_orchestrator, format_orchestrator_response

# Initialize single orchestrator (manages all agents)
orchestrator = create_orchestrator()

async def handle_text_message(event: MessageEvent, user_id: str):
    """Simplified handler using Orchestrator"""
    message = event.message.text

    # Single line routing - Orchestrator handles everything!
    result = await orchestrator.process_text(user_id=user_id, message=message)
    response_text = format_orchestrator_response(result)

    await line_bot_api.reply_message(event.reply_token, TextSendMessage(text=response_text))
```

### æ¶æ§‹å°æ¯”

**Before (if/elif åœ°ç„):**
```python
if is_command(msg):
    handle_command()
elif msg == '@g':
    handle_github()
elif is_youtube_url(msg):
    handle_youtube()
elif has_url(msg):
    handle_url()
else:
    handle_chat()
```

**After (A2A Orchestration):**
```python
result = await orchestrator.process_text(user_id, message)
response = format_orchestrator_response(result)
```

### æˆæœ

- PR #13 merged
- Release v0.6.0

---

## Phase 5: Session ç®¡ç†é·ç§»

### ç›®æ¨™

å»ºç«‹é›†ä¸­å¼ SessionManagerï¼Œæ”¯æ´ TTL è‡ªå‹•éæœŸå’ŒèƒŒæ™¯æ¸…ç†ã€‚

### å¯¦ä½œå…§å®¹

**1. SessionManager é¡åˆ¥**

```python
# services/session_manager.py
@dataclass
class SessionData:
    """Data structure for a single user session"""
    user_id: str
    chat: Any  # Gemini chat instance
    history: List[dict]
    created_at: datetime
    last_active: datetime

class SessionManager:
    """Centralized session manager with TTL and auto-cleanup"""

    def __init__(
        self,
        timeout_minutes: int = 30,
        max_history_length: int = 20,
        cleanup_interval_seconds: int = 300
    ):
        self.timeout = timedelta(minutes=timeout_minutes)
        self.max_history_length = max_history_length
        self._sessions: Dict[str, SessionData] = {}
        self._lock = Lock()  # Thread-safe
        self._cleanup_task = None

    def get_or_create_session(self, user_id: str, chat_factory: Callable) -> SessionData:
        """Get existing session or create new one"""
        with self._lock:
            session = self._sessions.get(user_id)

            if session and not self.is_expired(session):
                session.last_active = datetime.now()
                return session

            # Create new session
            new_session = SessionData(
                user_id=user_id,
                chat=chat_factory(),
                history=[],
                created_at=datetime.now(),
                last_active=datetime.now()
            )
            self._sessions[user_id] = new_session
            return new_session

    async def start_cleanup_task(self):
        """Start background cleanup task"""
        self._running = True
        self._cleanup_task = asyncio.create_task(self._cleanup_loop())

    async def _cleanup_loop(self):
        """Background loop for periodic cleanup"""
        while self._running:
            await asyncio.sleep(self.cleanup_interval)
            self.cleanup_expired_sessions()
```

**2. FastAPI ç”Ÿå‘½é€±æœŸæ•´åˆ**

```python
# main.py
from services.session_manager import get_session_manager

session_manager = get_session_manager()

@app.on_event("startup")
async def startup_event():
    """Start background tasks on startup"""
    await session_manager.start_cleanup_task()
    logger.info("Session cleanup background task started")

@app.on_event("shutdown")
async def shutdown_event():
    """Cleanup on shutdown"""
    await session_manager.stop_cleanup_task()
    await session.close()
    logger.info("Application shutdown complete")
```

**3. æ–°å¢ /stats æŒ‡ä»¤**

```python
# åœ¨ Orchestrator ä¸­è™•ç†
elif command in ['/session-stats', '/stats']:
    stats = self.chat_agent.session_manager.get_stats()
    return {
        'status': 'success',
        'response': f"""ğŸ“ˆ Session çµ±è¨ˆè³‡è¨Š

ğŸ‘¥ æ´»èºå°è©±æ•¸ï¼š{stats.active_sessions}
ğŸ’¬ ç¸½è¨Šæ¯æ•¸ï¼š{stats.total_messages}
â±ï¸ æœ€èˆŠå°è©±ï¼š{stats.oldest_session_age_minutes:.1f} åˆ†é˜
ğŸ§¹ æ¸…ç†æ¬¡æ•¸ï¼š{stats.cleanup_runs}
ğŸ—‘ï¸ å·²æ¸…ç†å°è©±ï¼š{stats.sessions_cleaned}"""
    }
```

### æˆæœ

- PR #14 merged
- Release v0.7.0

---

## æœ€çµ‚æ¶æ§‹

### å®Œæ•´çš„ A2A æµç¨‹

```
LINE Message
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Webhook                           â”‚
â”‚                    (main.py)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Orchestrator Agent                        â”‚
â”‚                                                             â”‚
â”‚  1. detect_intents() - åˆ†æç”¨æˆ¶æ„åœ–                          â”‚
â”‚  2. _route_intent() - è·¯ç”±åˆ°å°ˆæ¥­ Agent                       â”‚
â”‚  3. format_response() - å½™æ•´å›è¦†                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ChatAgent (Google Search Grounding)
     â”‚
     â”œâ”€â”€â”€ URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ContentAgent (Summarization)
     â”‚
     â”œâ”€â”€â”€ YOUTUBE â”€â”€â”€â”€â”€â–¶ ContentAgent (YouTube API)
     â”‚
     â”œâ”€â”€â”€ IMAGE â”€â”€â”€â”€â”€â”€â”€â–¶ VisionAgent (Gemini Multimodal)
     â”‚
     â”œâ”€â”€â”€ LOCATION â”€â”€â”€â”€â–¶ LocationAgent (Maps Grounding)
     â”‚
     â””â”€â”€â”€ GITHUB â”€â”€â”€â”€â”€â”€â–¶ GitHubAgent (GitHub API)
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ SessionManager  â”‚
                    â”‚ (èƒŒæ™¯æ¸…ç† Task) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ”¯æ´çš„æ„åœ–èˆ‡æŒ‡ä»¤

| æ„åœ– | è§¸ç™¼æ¢ä»¶ | è™•ç† Agent |
|------|---------|-----------|
| CHAT | ä¸€èˆ¬æ–‡å­—è¨Šæ¯ | ChatAgent |
| URL_SUMMARY | åŒ…å« HTTP URL | ContentAgent |
| YOUTUBE_SUMMARY | YouTube URL | ContentAgent |
| IMAGE_ANALYSIS | åœ–ç‰‡è¨Šæ¯ | VisionAgent |
| LOCATION_SEARCH | ä½ç½®è¨Šæ¯ | LocationAgent |
| GITHUB_SUMMARY | `@g` æŒ‡ä»¤ | GitHubAgent |
| COMMAND | `/clear`, `/help`, `/status`, `/stats` | Orchestrator ç›´æ¥è™•ç† |

---

## é–‹ç™¼å¿ƒå¾—

### 1. åˆ†éšæ®µé·ç§»é™ä½é¢¨éšª

é€™æ¬¡é·ç§»æœ€é‡è¦çš„æ±ºç­–æ˜¯**åˆ† 5 å€‹éšæ®µé€²è¡Œ**ï¼Œæ¯å€‹éšæ®µéƒ½æ˜¯ç¨ç«‹çš„ PRï¼š

```
Phase 1 (ä½é¢¨éšª) â†’ Phase 2 (ä¸­é¢¨éšª) â†’ Phase 3 (ä¸­é¢¨éšª) â†’ Phase 4 (é«˜é¢¨éšª) â†’ Phase 5 (ä¸­é¢¨éšª)
```

æ¯å€‹éšæ®µå®Œæˆå¾Œéƒ½å¯ä»¥æ­£å¸¸é‹ä½œï¼Œä¸æœƒæœ‰ã€Œæ”¹åˆ°ä¸€åŠç³»çµ±å£æ‰ã€çš„æƒ…æ³ã€‚

### 2. ä¿ç•™èˆŠç‰ˆç›¸å®¹

æˆ‘åˆ»æ„ä¿ç•™äº† `loader/` ç›®éŒ„ï¼Œè®“èˆŠçš„ç¨‹å¼ç¢¼ä»ç„¶å¯ç”¨ï¼š

```python
# æ–°ç‰ˆ tools/ å…§éƒ¨å‘¼å«èˆŠç‰ˆ loader/
from loader.url import load_url as legacy_load_url

def load_url(url: str) -> dict:
    """ADK-compatible wrapper"""
    result = legacy_load_url(url)
    return {"status": "success", "content": result}
```

é€™æ¨£åšçš„å¥½è™•æ˜¯ï¼š
- âœ… å¯ä»¥æ¼¸é€²å¼é·ç§»
- âœ… å‡ºå•é¡Œå¯ä»¥å¿«é€Ÿå›æ»¾
- âœ… ä¸éœ€è¦ä¸€æ¬¡é‡å¯«æ‰€æœ‰é‚è¼¯

### 3. Intent Detection vs LLM Routing

åœ¨è¨­è¨ˆ Orchestrator æ™‚ï¼Œæˆ‘è€ƒæ…®éå…©ç¨®æ–¹æ¡ˆï¼š

**æ–¹æ¡ˆ A: è¦å‰‡å¼ Intent Detectionï¼ˆé¸æ“‡æ­¤æ–¹æ¡ˆï¼‰**
```python
def detect_intents(self, message: str) -> List[Intent]:
    if self._youtube_pattern.match(message):
        return [Intent(IntentType.YOUTUBE_SUMMARY, ...)]
```

**æ–¹æ¡ˆ B: LLM Routing**
```python
async def detect_intents(self, message: str) -> List[Intent]:
    prompt = f"åˆ†æä»¥ä¸‹è¨Šæ¯çš„æ„åœ–: {message}"
    result = await self.llm.generate(prompt)
    return parse_intents(result)
```

æˆ‘é¸æ“‡æ–¹æ¡ˆ A çš„åŸå› ï¼š
- âœ… é€Ÿåº¦æ›´å¿«ï¼ˆä¸éœ€è¦é¡å¤– API å‘¼å«ï¼‰
- âœ… æˆæœ¬æ›´ä½
- âœ… è¡Œç‚ºå¯é æ¸¬
- âœ… å°æ–¼ LINE Bot é€™ç¨®æ˜ç¢ºçš„è¼¸å…¥æ ¼å¼å·²ç¶“è¶³å¤ 

### 4. Parallel Execution çš„å¨åŠ›

A2A æ¶æ§‹æœ€å¼·å¤§çš„åœ°æ–¹æ˜¯**ä¸¦è¡ŒåŸ·è¡Œ**ï¼š

```python
# ç”¨æˆ¶è¨Šæ¯: "å¹«æˆ‘æ‘˜è¦ https://... ç„¶å¾Œæ‰¾é™„è¿‘é¤å»³"
intents = [
    Intent(IntentType.URL_SUMMARY, ...),
    Intent(IntentType.LOCATION_SEARCH, ...)
]

# ä¸¦è¡ŒåŸ·è¡Œï¼
tasks = [self._route_intent(user_id, intent) for intent in intents]
results = await asyncio.gather(*tasks)
```

èˆŠç‰ˆæ¶æ§‹éœ€è¦**é †åºåŸ·è¡Œ**ï¼Œæ–°ç‰ˆå¯ä»¥ä¸¦è¡Œè™•ç†ï¼Œå¤§å¹…ç¸®çŸ­å›æ‡‰æ™‚é–“ã€‚

### 5. Session ç®¡ç†çš„é‡è¦æ€§

å°‡ Session ç®¡ç†ç¨ç«‹æˆ `SessionManager` æœå‹™å¸¶ä¾†å¾ˆå¤šå¥½è™•ï¼š

- âœ… **é›†ä¸­ç®¡ç†** - æ‰€æœ‰ Agent å…±ç”¨åŒä¸€å€‹ Session ç‹€æ…‹
- âœ… **è‡ªå‹•æ¸…ç†** - èƒŒæ™¯ Task å®šæœŸæ¸…ç†éæœŸ Session
- âœ… **Thread-safe** - ä½¿ç”¨ Lock ç¢ºä¿ä¸¦ç™¼å®‰å…¨
- âœ… **å¯ç›£æ§** - `/stats` æŒ‡ä»¤æŸ¥çœ‹ Session çµ±è¨ˆ

---

## ç‰ˆæœ¬ç™¼å¸ƒè¨˜éŒ„

| ç‰ˆæœ¬ | éšæ®µ | ä¸»è¦å…§å®¹ |
|------|------|---------|
| v0.3.0 | Phase 1 | å®‰è£ ADKã€é‡æ§‹ Tools |
| v0.4.0 | Phase 2 | ChatAgent + LINE æ•´åˆ |
| v0.5.0 | Phase 3 | å°ˆæ¥­ Agents (Content, Location, Vision, GitHub) |
| v0.6.0 | Phase 4 | Orchestrator + A2A è·¯ç”± |
| v0.7.0 | Phase 5 | SessionManager + èƒŒæ™¯æ¸…ç† |

---

## çµè«–

å¾ if/elif åœ°ç„åˆ° Multi-Agent Orchestrationï¼Œé€™æ¬¡é‡æ§‹å¸¶ä¾†çš„æ”¹è®Šï¼š

| é¢å‘ | æ”¹é€ å‰ | æ”¹é€ å¾Œ |
|------|--------|--------|
| **ç¨‹å¼ç¢¼çµ„ç¹”** | å…¨éƒ¨åœ¨ main.py | åˆ†æ•£åˆ° agents/, tools/, services/ |
| **è¨Šæ¯è·¯ç”±** | if/elif æ¢ä»¶å¼ | Intent Detection + A2A |
| **ä¸¦è¡Œè™•ç†** | ä¸æ”¯æ´ | asyncio.gather ä¸¦è¡ŒåŸ·è¡Œ |
| **Session ç®¡ç†** | æ•£è½å„è™• | é›†ä¸­å¼ SessionManager |
| **å¯æ¸¬è©¦æ€§** | å›°é›£ | æ¯å€‹ Agent å¯ç¨ç«‹æ¸¬è©¦ |
| **å¯æ“´å±•æ€§** | åŠ  elif | åŠ æ–° Agent |

å¦‚æœä½ ä¹Ÿåœ¨ç¶­è­·ä¸€å€‹åŠŸèƒ½è¶Šä¾†è¶Šå¤šçš„ Botï¼Œå¼·çƒˆå»ºè­°è€ƒæ…® ADK + A2A æ¶æ§‹ã€‚é›–ç„¶åˆæœŸæŠ•å…¥è¼ƒå¤§ï¼Œä½†é•·æœŸç¶­è­·æˆæœ¬æœƒå¤§å¹…é™ä½ã€‚

## åƒè€ƒè³‡æ–™

- [Google Agent Development Kit (ADK)](https://google.github.io/adk-docs/) - å®˜æ–¹æ–‡ä»¶
- [Vertex AI Gemini API](https://cloud.google.com/vertex-ai/docs/generative-ai/model-reference/gemini) - Gemini æ¨¡å‹æ–‡ä»¶
- [linebot-helper-python Repository](https://github.com/kkdai/linebot-helper-python) - å°ˆæ¡ˆåŸå§‹ç¢¼
- [LINE Messaging API](https://developers.line.biz/en/docs/messaging-api/) - LINE Bot æ–‡ä»¶
